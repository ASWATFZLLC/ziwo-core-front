{"version":3,"file":"ziwo-core-front.es5.js","sources":["../src/messages.ts","../src/authentication.service.ts","../src/rtc/channel.ts","../src/rtc/userMedia.ts","../src/regex.ts","../src/events.ts","../src/rtc/rtc-client.ts","../src/api.service.ts","../src/main.ts"],"sourcesContent":["const MESSAGE_PREFIX = '[LIB Ziwo-core-front] ';\n\nexport const MESSAGES = {\n  EMAIL_PASSWORD_AUTHTOKEN_MISSING: `${MESSAGE_PREFIX}Email or password are missing and no authentication token were provided.`,\n  INVALID_PHONE_NUMBER: (phoneNumber:string) => `${phoneNumber} is not a valid phone number`,\n  AGENT_NOT_CONNECTED: (action:string) => `Agent is not connected. Cannot proceed '${action}'`,\n};\n","import {ApiService} from './api.service';\nimport {MESSAGES} from './messages';\n\n/**\n * Credential provided by Ziwo\n * @email is the agent's email\n * @password is the agent's password\n */\nexport interface Credentials {\n  /**\n   * @email is the agent email\n   * If not provided, please provide @authenticationToken\n   */\n  email:string;\n\n  /**\n   * @email is the agent password\n   * If not provided, please provide @authenticationToken\n   */\n  password:string;\n\n  /**\n   * @authenticationToken is the token provided by the /login API\n   * If not provided, please provide @authenticationToken\n   */\n  authenticationToken?:string;\n}\n\nenum UserStatus {\n  Active = 'active',\n}\n\nenum UserType {\n  Admin = 'admin',\n}\n\nenum UserProfileType {\n  User = 'users'\n}\n\nexport interface User {\n  id:number;\n  firstName:string;\n  lastName:string;\n  username:string;\n  status:UserStatus;\n  type:UserType;\n  photo:string;\n  roleId:number;\n  lastLoginAt:string;\n  contactNumber:null|string;\n  createdAt:string;\n  updatedAt:string;\n  access_token:string;\n  profileType:UserProfileType;\n  role:any;\n  roles:any;\n}\n\ninterface UserInfo extends User {\n  ccLogin:number;\n  ccPassword:number;\n  liveInfo:any;\n  liveCalls:any[];\n  wrapUpTime:number;\n  noAnswerDelayTime:any;\n  noAnswerTimeout:any;\n  roamingContactNumber:string;\n  roamingTimeout:number;\n}\n\ninterface Queue {\n  announcementType:string;\n  callerIDNumber:any|null;\n  ​createdAt:string;\n  ​deletedAt:string|null;\n  ​id:number;\n  ​image:string|null;\n  ​language:string;\n  ​maxWaitTime:number;\n  ​moh:string;\n  ​name:string;\n  ​nonWorkingHoursDID:string;\n  ​priority:number;\n  ​status:string;\n  ​strategyType:string;\n  ​surveyRequired:boolean;\n  ​timeslots:string;\n  ​updatedAt:string;\n  ​urgentMessage:any|null;\n  ​waitTimeoutDID:string;\n}\n\ninterface Number {\n  beyondTimeslotsLinkData:any|null;\n  ​​beyondTimeslotsLinkType:any|null;\n  ​​createdAt:string;\n  ​​deletedAt:any|null;\n  ​​did:string;\n  ​​didCalled:string;\n  ​​didDisplay:string;\n  ​​id:number;\n  ​​linkData:string;\n  ​​linkType:string;\n  ​​status:string;\n  ​​length:number;\n  ​​timeslots:any[];\n  ​​updatedAt:string;\n  ​​urgentMessage:any|null;\n}\n\ninterface WebRtcInfo {\n  port:string;\n  protocol:string;\n}\n\nexport interface AgentInfo {\n  userInfo:UserInfo;\n  queues:Queue[];\n  numbers:Number[];\n  webRtc:WebRtcInfo;\n}\n\n\nexport class AuthenticationService {\n\n  constructor() {}\n\n  public static authenticate(api:ApiService, credentials:Credentials):Promise<AgentInfo> {\n    if (credentials.authenticationToken) {\n      api.setToken(credentials.authenticationToken);\n      return new Promise<any>((onRes, onErr) => {\n        this.initAgent(api).then(res => onRes(res)).catch(err => onErr(err));\n      });\n    }\n    if (!credentials.email || !credentials.password) {\n      throw new Error(MESSAGES.EMAIL_PASSWORD_AUTHTOKEN_MISSING);\n    }\n    return new Promise<any>((onRes, onErr) => {\n      this.loginZiwo(api, credentials.email, credentials.password).then(() => {\n        this.initAgent(api).then(res => onRes(res)).catch(err => onErr(err));\n      }).catch(err => onErr(err));\n    });\n  }\n\n  private static loginZiwo(api:ApiService, email:string, password:string):Promise<User> {\n    return new Promise<User>((onRes, onErr) => {\n      api.post<User>(api.endpoints.authenticate, {\n        username: email,\n        password: password,\n      }).then(r => {\n        api.setToken(r.content.access_token);\n        onRes(r.content);\n      }).catch(e => {\n        onErr(e);\n      });\n    });\n  }\n\n  private static initAgent(api:ApiService):Promise<AgentInfo> {\n    return new Promise<AgentInfo>((onRes, onErr) => {\n      Promise.all([\n        this.fetchAgentProfile(api),\n        this.fetchListQueues(api),\n        this.fetchListNumbers(api),\n        this.fetchWebRTCConfig(api),\n      ]).then(res => {\n        onRes({\n          userInfo: res[0],\n          queues: res[1] || [],\n          numbers: res[2] || [],\n          webRtc: res[3],\n        });\n      })\n      .catch(err => onErr(err));\n    });\n  }\n\n  private static fetchAgentProfile(api:ApiService):Promise<any> {\n    return new Promise<any>((onRes, onErr) => {\n      api.get(api.endpoints.profile).then(res => {\n        onRes(res.content);\n      }).catch(err => onErr(err));\n    });\n  }\n\n  private static fetchListQueues(api:ApiService):Promise<any> {\n    return new Promise<any>((onRes, onErr) => {\n      api.get('/agents/channels/calls/listQueues').then(res => {\n        onRes(res.content);\n      }).catch(err => onErr(err));\n    });\n  }\n\n  private static fetchListNumbers(api:ApiService):Promise<any> {\n    return new Promise<any>((onRes, onErr) => {\n      api.get('/agents/channels/calls/listNumbers').then(res => {\n        onRes(res.content);\n      }).catch(err => onErr(err));\n    });\n  }\n\n  private static fetchWebRTCConfig(api:ApiService):Promise<any> {\n    return new Promise<any>((onRes, onErr) => {\n      api.get('/fs/webrtc/config').then(res => {\n        onRes(res.content);\n      }).catch(err => onErr(err));\n    });\n  }\n\n}\n","\ninterface MicrophoneData {\n  filterNode:BiquadFilterNode;\n  gainNode:GainNode;\n  source:MediaStreamAudioSourceNode;\n}\n\nexport interface VideoInfo {\n  selfTag?:Element;\n  peerTag?:Element;\n}\n\nexport class Channel {\n\n  public readonly stream:any;\n\n  private microphone?:MicrophoneData;\n\n  private readonly audioContext:AudioContext;\n\n  constructor(stream:any) {\n    this.stream = stream;\n    this.audioContext = this.getAudioContext();\n  }\n\n  public startMicrophone():void {\n    // see https://dvcs.w3.org/hg/audio/raw-file/tip/webaudio/specification.html#BiquadFilterNode-section\n    const filterNode = this.audioContext.createBiquadFilter();\n    filterNode.type = 'highpass';\n    // cutoff frequency: for highpass, audio is attenuated below this frequency\n    filterNode.frequency.value = 10000;\n\n    // create a gain node (to change audio volume)\n    const gainNode = this.audioContext.createGain();\n    // default is 1 (no change); less than 1 means audio is attenuated and vice versa\n    gainNode.gain.value = 0.5;\n\n    const source = this.audioContext.createMediaStreamSource(this.stream);\n\n    this.microphone = {\n      filterNode,\n      gainNode,\n      source,\n    };\n  }\n\n  public bindVideo(el:any):void {\n    if (!el.srcObject) {\n      // TODO : emit appropriate error message\n      return;\n    }\n    el.srcObject = this.stream;\n  }\n\n  private getAudioContext():AudioContext {\n    let audioContext;\n    if (typeof AudioContext === 'function') {\n      audioContext = new AudioContext();\n    } else {\n      throw new Error('Web audio not supported');\n    }\n    return audioContext;\n  }\n\n}\n","import {Channel} from './channel';\n\nexport interface MediaRequested {\n  audio?:boolean;\n  video?:{\n    selfTag:Element;\n    peerTag:Element;\n  };\n}\n\nexport class UserMedia {\n\n  public static getUserMedia(mediaRequested:UserMedia):Promise<Channel> {\n    return new Promise<Channel>((onRes, onErr) => {\n      try {\n        navigator.mediaDevices.getUserMedia(mediaRequested).then((stream) => {\n          onRes(new Channel(stream));\n        });\n      } catch (e) {\n        onErr(e);\n      }\n    });\n  }\n\n}\n","\nexport const PATTERNS = {\n  phoneNumber: /^\\+?\\d+$/,\n};\n","\n/**\n * TODO : documentation\n * TODO : define interface for each available type?\n * TODO : define all event type\n */\n\nexport enum ErrorCode {\n  InvalidPhoneNumber,\n  UserMediaError,\n  AgentNotConnected,\n}\n\nexport interface ErrorData {\n  code:ErrorCode;\n  message:string;\n  data?:any;\n}\n\nexport enum ZiwoEventType {\n  Error = 'Error',\n  AgentConnected = 'AgentConnected',\n  IncomingCall = 'IncomingCall',\n  OutgoingCall = 'OutgoingCall',\n  CallStarted = 'CallStarted',\n  CallEndedByUser = 'CallEndedByUser',\n  CallEndedByPeer = 'CallEndedByPeer',\n}\n\nexport class ZiwoEvent {\n\n  public static listeners:Function[] = [];\n\n  public static subscribe(func:Function):void {\n    this.listeners.push(func);\n  }\n\n  public static emit(type:ZiwoEventType, data?:any):void {\n    this.listeners.forEach(x => x(type, data));\n  }\n}\n","import {AgentInfo} from '../authentication.service';\nimport {UserMedia} from './userMedia';\nimport {PATTERNS} from '../regex';\nimport {MESSAGES} from '../messages';\nimport {ZiwoEvent, ZiwoEventType, ErrorCode} from '../events';\nimport {Channel, VideoInfo} from './channel';\n\nenum RtcAction {\n  StartCall = 'Start call',\n}\n\nexport interface MediaConstraint {\n  audio:boolean;\n  video:boolean;\n}\n\n/**\n * RtcClient wraps all interaction with WebRTC\n */\nexport class RtcClient {\n\n  public connectedAgent?:AgentInfo;\n  public channel?:Channel;\n  public videoInfo?:VideoInfo;\n\n  constructor(video?:VideoInfo) {\n    if (video) {\n      this.videoInfo = video;\n    }\n  }\n\n  /**\n   * Connect an agent using its Info\n   */\n  public connectAgent(agent:AgentInfo):void {\n    console.log('Init RTC with > ', agent);\n    this.connectedAgent = agent;\n    UserMedia.getUserMedia({audio: true, video: this.videoInfo ? true : false})\n      .then(c => {\n        this.channel = c;\n        window.setTimeout(() => {\n          ZiwoEvent.emit(ZiwoEventType.AgentConnected);\n        }, 100);\n      }).catch(e => {\n        ZiwoEvent.emit(ZiwoEventType.Error, {\n          code: ErrorCode.UserMediaError,\n          message: e,\n        });\n      });\n  }\n\n  /**\n   * Get connected Agent returns the Info of the current agent\n   */\n  public getConnectedAgent():AgentInfo|undefined {\n    return this.connectedAgent;\n  }\n\n  /**\n   * Return true if an agent is connected\n   */\n  public isAgentConnected():boolean {\n    return !! this.connectedAgent && !! this.channel;\n  }\n\n  public startCall(phoneNumber:string):void {\n    if (!this.isAgentConnected() || !this.channel) {\n      this.sendNotConnectedEvent('start call');\n      return;\n    }\n    if (!PATTERNS.phoneNumber.test(phoneNumber)) {\n      return ZiwoEvent.emit(ZiwoEventType.Error, {\n        code: ErrorCode.InvalidPhoneNumber,\n        message: MESSAGES.INVALID_PHONE_NUMBER(phoneNumber),\n        data: {\n          phoneNumber: phoneNumber,\n        }\n      });\n    }\n    this.channel?.startMicrophone();\n    if (this.videoInfo && this.videoInfo.selfTag) {\n      this.channel.bindVideo(this.videoInfo.selfTag);\n    }\n  }\n\n  private sendNotConnectedEvent(action:string):void {\n    return ZiwoEvent.emit(ZiwoEventType.Error, {\n      code: ErrorCode.InvalidPhoneNumber,\n      message: MESSAGES.AGENT_NOT_CONNECTED(action),\n    });\n  }\n\n}\n","\nexport interface ApiResult<T> {\n  result:boolean;\n  info:any;\n  content:T;\n}\n\nexport interface AsyncApiResult<T> extends Promise<ApiResult<T>> {}\n\n/**\n * ApiService wraps the axios to provide quick GET, POST, PUT and DELETE\n *\n * Usage:\n *\n *  const apiService = new ApiService('kalvad-poc'); // contact center name you want to connect to\n *  apiService.get<User>(apiService.endpoints.authenticate) ; // ApiService already defined the endpoints available on Ziwo API\n *    .then( (e) => console.log('User > ', e.data)); // Request object is available under `data`;\n */\nexport class ApiService {\n\n  public readonly endpoints:any;\n\n  private token?:string;\n  private readonly baseUrl:string;\n  private readonly API_PROTOCOL = 'https://';\n  private readonly API_PREFIX = '-api.aswat.co';\n\n  constructor(contactCenterName:string) {\n    this.baseUrl = `${this.API_PROTOCOL}${contactCenterName}${this.API_PREFIX}`;\n    this.endpoints = {\n      authenticate: `/auth/login`,\n      profile: '/profile',\n    };\n  }\n\n  /**\n   * Set Authorization token for further requests\n   */\n  public setToken(token:string):void {\n    this.token = token;\n  }\n\n  /**\n   * Execute a GET query\n   * @endpoint url endpoint. Base url should not be included\n   */\n  public get<T>(endpoint:string):AsyncApiResult<T> {\n    return this.query<T>(endpoint, 'GET');\n  }\n\n  /**\n   * Execute a POST query\n   * @endpoint url endpoint. Base url should not be included\n   */\n  public post<T>(endpoint:string, payload:any):AsyncApiResult<T> {\n    return this.query<T>(endpoint, 'POST', payload);\n  }\n\n  /**\n   * Execute a PUT query\n   * @endpoint url endpoint. Base url should not be included\n   */\n  public put<T>(endpoint:string, payload:any):AsyncApiResult<T> {\n    return this.query<T>(endpoint, 'PUT', payload);\n  }\n\n  /**\n   * Execute a DELETE query\n   * @endpoint url endpoint. Base url should not be included\n   */\n  public delete<T>(endpoint:string):AsyncApiResult<T> {\n    return this.query<T>(endpoint, 'DELETE');\n  }\n\n  private query<T>(endpoint:string, method:'GET'|'POST'|'PUT'|'DELETE', payload?:any):Promise<ApiResult<T>> {\n    return new Promise<ApiResult<T>>((onRes, onErr) => {\n      const fetchOptions:any = {\n        method: method,\n      };\n      if (payload) {\n        fetchOptions.body = JSON.stringify(payload);\n      }\n      window.fetch(`${this.baseUrl}${endpoint}`, {\n        method: method,\n        body: payload ? JSON.stringify(payload) : undefined,\n        headers: {\n          'Content-Type': 'application/json',\n          'access_token': `${this.token}`,\n        }\n      }).then(res => {\n        if (!res.ok) {\n          onErr(`Fetch error: ${res.statusText}`);\n          return;\n        }\n        onRes(res.json());\n      }).catch(err => onErr(err));\n    });\n  }\n\n}\n","import {Credentials, AuthenticationService, AgentInfo} from './authentication.service';\nimport {RtcClient} from './rtc/rtc-client';\nimport {ApiService} from './api.service';\nimport {ZiwoEvent, ZiwoEventType} from './events';\nimport {VideoInfo} from './rtc/channel';\n\n/**\n * ziwo-core-front provides a client for real time communication using WebRTC integrated with Ziwo\n */\n\nexport interface ZiwoClientOptions {\n  /**\n   * @contactCenterName is the contact center the agent is working for\n   */\n  contactCenterName:string;\n\n  /**\n   * see `authentication.ts#Credentials` for complete definition\n   * If `credentials` is not provided, please provide an Authentication Token\n   */\n  credentials:Credentials;\n\n  /**\n   * @autoConnect let you choose to connect the agent automatically or not.\n   * Default = true\n   * Error is raised if authentication fails. In case you want to handle failed authentication, run `connect` manually\n   */\n  autoConnect:boolean;\n\n  /**\n   *\n   */\n  video?:VideoInfo;\n}\n\nexport class ZiwoClient {\n\n  public readonly options:ZiwoClientOptions;\n\n  private apiService:ApiService;\n  private rtcClient:RtcClient;\n\n  constructor(options:ZiwoClientOptions) {\n    this.options = options;\n    this.apiService = new ApiService(options.contactCenterName);\n    this.rtcClient = new RtcClient(options.video);\n    if (options.autoConnect) {\n      this.connect().then(r => {\n      }).catch(err => { throw err; });\n    }\n  }\n\n  public connect():Promise<AgentInfo> {\n    return new Promise<any>((onRes, onErr) => {\n      AuthenticationService.authenticate(this.apiService, this.options.credentials)\n        .then(res => {\n          this.rtcClient.connectAgent(res);\n          onRes(res);\n        }).catch(err => onErr(err));\n    });\n  }\n\n  public addListener(func:Function):void {\n    return ZiwoEvent.subscribe(func);\n  }\n\n  public startCall(phoneNumber:string):void {\n    this.rtcClient.startCall(phoneNumber);\n  }\n\n}\n"],"names":[],"mappings":"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"}