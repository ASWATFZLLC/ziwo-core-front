{"version":3,"file":"ziwo-core-front.umd.js","sources":["../src/messages.ts","../src/authentication.service.ts","../src/rtc/rtc-client.ts","../src/api/api.service.ts","../src/main.ts"],"sourcesContent":["const MESSAGE_PREFIX = '[LIB Ziwo-core-front] ';\n\nexport const MESSAGES = {\n  EMAIL_PASSWORD_AUTHTOKEN_MISSING: `${MESSAGE_PREFIX}Email or password are missing and no authentication token were provided.`\n};\n","import {ApiService, ApiResult, AsyncApiResult} from './api/api.service';\nimport {MESSAGES} from './messages';\n\n/**\n * Credential provided by Ziwo\n * @email is the agent's email\n * @password is the agent's password\n */\nexport interface Credentials {\n  /**\n   * @email is the agent email\n   * If not provided, please provide @authenticationToken\n   */\n  email:string;\n\n  /**\n   * @email is the agent password\n   * If not provided, please provide @authenticationToken\n   */\n  password:string;\n\n  /**\n   * @authenticationToken is the token provided by the /login API\n   * If not provided, please provide @authenticationToken\n   */\n  authenticationToken?:string;\n}\n\nenum UserStatus {\n  Active = 'active',\n}\n\nenum UserType {\n  Admin = 'admin',\n}\n\nenum UserProfileType {\n  User = 'users'\n}\n\nexport interface User {\n  id:number;\n  firstName:string;\n  lastName:string;\n  username:string;\n  status:UserStatus;\n  type:UserType;\n  photo:string;\n  roleId:number;\n  lastLoginAt:string;\n  contactNumber:null|string;\n  createdAt:string;\n  updatedAt:string;\n  access_token:string;\n  profileType:UserProfileType;\n  role:any;\n  roles:any;\n}\n\nexport class AuthenticationService {\n\n  constructor() {}\n\n  public static authenticate(api:ApiService, credentials:Credentials):Promise<any> {\n    if (credentials.authenticationToken) {\n      api.setToken(credentials.authenticationToken);\n      return this.loginCallCenter(api);\n    }\n    if (!credentials.email || !credentials.password) {\n      throw new Error(MESSAGES.EMAIL_PASSWORD_AUTHTOKEN_MISSING);\n    }\n    return new Promise<any>((onRes, onErr) => {\n      this.loginZiwo(api, credentials.email, credentials.password).then(() => {\n        this.loginCallCenter(api).then(res => onRes(res)).catch(err => onErr(err));\n      }).catch(err => onErr(err));\n    });\n  }\n\n  private static loginCallCenter(api:ApiService):Promise<any> {\n    return new Promise<any>((onRes, onErr) => {\n      api.get(api.endpoints.profile).then(res => {\n        console.log('Agent profile', res);\n      }).catch(err => onErr(err));\n    });\n  }\n\n  private static loginZiwo(api:ApiService, email:string, password:string):Promise<User> {\n    return new Promise<User>((onRes, onErr) => {\n      api.post<User>(api.endpoints.authenticate, {\n        username: email,\n        password: password,\n      }).then(r => {\n        api.setToken(r.content.access_token);\n        onRes(r.content);\n      }).catch(e => {\n        onErr(e);\n      });\n    });\n  }\n\n}\n","/**\n * RtcClient wraps all interaction with WebRTC\n */\nexport class RtcClient {\n\n  constuctor() {}\n\n}\n","\nexport interface ApiResult<T> {\n  result:boolean;\n  info:any;\n  content:T;\n}\n\nexport interface AsyncApiResult<T> extends Promise<ApiResult<T>> {}\n\n/**\n * ApiService wraps the axios to provide quick GET, POST, PUT and DELETE\n *\n * Usage:\n *\n *  const apiService = new ApiService('kalvad-poc'); // contact center name you want to connect to\n *  apiService.get<User>(apiService.endpoints.authenticate) ; // ApiService already defined the endpoints available on Ziwo API\n *    .then( (e) => console.log('User > ', e.data)); // Request object is available under `data`;\n */\nexport class ApiService {\n\n  public readonly endpoints:any;\n\n  private token?:string;\n  private readonly baseUrl:string;\n  private readonly API_PROTOCOL = 'https://';\n  private readonly API_PREFIX = '-api.aswat.co';\n\n  constructor(contactCenterName:string) {\n    this.baseUrl = `${this.API_PROTOCOL}${contactCenterName}${this.API_PREFIX}`;\n    this.endpoints = {\n      authenticate: `/auth/login`,\n      profile: '/profile',\n    };\n  }\n\n  /**\n   * Set Authorization token for further requests\n   */\n  public setToken(token:string):void {\n    this.token = token;\n  }\n\n  /**\n   * Execute a GET query\n   * @endpoint url endpoint. Base url should not be included\n   */\n  public get<T>(endpoint:string):AsyncApiResult<T> {\n    return this.query<T>(endpoint, 'GET');\n  }\n\n  /**\n   * Execute a POST query\n   * @endpoint url endpoint. Base url should not be included\n   */\n  public post<T>(endpoint:string, payload:any):AsyncApiResult<T> {\n    return this.query<T>(endpoint, 'POST', payload);\n  }\n\n  /**\n   * Execute a PUT query\n   * @endpoint url endpoint. Base url should not be included\n   */\n  public put<T>(endpoint:string, payload:any):AsyncApiResult<T> {\n    return this.query<T>(endpoint, 'PUT', payload);\n  }\n\n  /**\n   * Execute a DELETE query\n   * @endpoint url endpoint. Base url should not be included\n   */\n  public delete<T>(endpoint:string):AsyncApiResult<T> {\n    return this.query<T>(endpoint, 'DELETE');\n  }\n\n  private query<T>(endpoint:string, method:'GET'|'POST'|'PUT'|'DELETE', payload?:any):Promise<ApiResult<T>> {\n    return new Promise<ApiResult<T>>((onRes, onErr) => {\n      const fetchOptions:any = {\n        method: method,\n      };\n      if (payload) {\n        fetchOptions.body = JSON.stringify(payload);\n      }\n      window.fetch(`${this.baseUrl}${endpoint}`, {\n        method: method,\n        body: payload ? JSON.stringify(payload) : undefined,\n        headers: {\n          'Content-Type': 'application/json',\n          'access_token': `${this.token}`,\n        }\n      }).then(res => {\n        if (!res.ok) {\n          onErr(`Fetch error: ${res.statusText}`);\n          return;\n        }\n        onRes(res.json());\n      }).catch(err => onErr(err));\n    });\n  }\n\n}\n","import {Credentials, AuthenticationService} from './authentication.service';\nimport {RtcClient} from './rtc/rtc-client';\nimport {ApiService} from './api/api.service';\n\n/**\n * ziwo-core-front provides a client for real time communication using WebRTC integrated with Ziwo\n */\n\nexport interface ZiwoClientOptions {\n  /**\n   * @contactCenterName is the contact center the agent is working for\n   */\n  contactCenterName:string;\n\n  /**\n   * see `authentication.ts#Credentials` for complete definition\n   * If `credentials` is not provided, please provide an Authentication Token\n   */\n  credentials:Credentials;\n\n  /**\n   * @autoConnect let you choose to connect the agent automatically or not.\n   * Default = true\n   * Error is raised if authentication fails. In case you want to handle failed authentication, run `connect` manually\n   */\n  autoConnect:boolean;\n\n}\n\nexport class ZiwoClient {\n\n  public readonly options:ZiwoClientOptions;\n\n  private apiService:ApiService;\n  private rtcClient:RtcClient;\n\n  constructor(options:ZiwoClientOptions) {\n    this.options = options;\n    this.apiService = new ApiService(options.contactCenterName);\n    this.rtcClient = new RtcClient();\n\n    if (options.autoConnect) {\n      this.connect().then().catch(err => {throw err;});\n    }\n  }\n\n  public connect():Promise<any> {\n    return AuthenticationService.authenticate(this.apiService, this.options.credentials);\n  }\n\n}\n"],"names":[],"mappings":"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"}